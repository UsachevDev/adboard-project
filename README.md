# Проект AdBoard

## Описание
AdBoard — это веб-приложение, предназначенное для управления и просмотра объявлений. Проект предоставляет API для аутентификации пользователей, регистрации и управления объявлениями, которые организованы по категориям и подкатегориям. Приложение использует бекенд на платформе .NET и фронтенд на Next.js, что позволяет удобно развёртывать его в Docker.
Поддерживаются такие функции, как:
- Регистрация и изменение данных пользователя.
- Аутентификация на основе JWT, с использованием access-токена и httpOnly refresh-токена.
- Добавление, редактирование, скрытие объявлений.
- Поиск по категориям, подкатегориям, ключевым словам.
- Добавление/удаление объявлений в избранное.
- Отзывы к объявлениям к расчетом средней оценки пользователя.
- Адаптивная верстка.

---

## Маршруты и поведение

### Главная (`/`)
- Подгружает **категории** и **объявления**, маппит `subcategory → category` (см. `mapCategory`).
- Реализована **постепенная догрузка** карточек по `IntersectionObserver` (константа `BATCH_SIZE`).
- Карточка — `AnnouncementCard`, сетка и адаптивная верстка.

### Поиск (`/search`)
- Читает параметры из URL через `useSearchParams()` (страница обёрнута в `<Suspense>` для корректной работы в App Router).
- Компонент `Search` находится в шапке и на странице, формирует URL с параметрами фильтра.

### Создать объявление (`/add-announcement`)
- **Клиентская форма** с валидацией:
  - обязательные поля (заголовок, описание, цена, город, категория),
  - город — **только буквы** (регулярка),
  - подкатегория — автосписок после выбора категории.
- Отправка `AddAnnouncementRequest` через `lib/api.addAnnouncement()`, редирект `router.push` на созданное объявление.

### Детальная объявление (`/announcements/[id]`)
- Загрузка объявления и привязанных данных.
- Для автора доступно **редактирование** (модалка `EditAnnouncementModal`).

### Профиль (`/profile` и `/profile/[id]`)
- `/profile` — страница текущего пользователя (использует `UserContext`).
- `/profile/[id]` — публичный профиль пользователя.
- `/profile/[id]/reviews` — список/лента отзывов.

### Избранное (`/favorites`)
- Список помеченных объявлений; для карточек используется общий `AnnouncementCard`.
- Переключатели избранного работают через API, состояние пользователя берётся из `UserContext`.

---

## Работа с данными

- **Категории** (`getCategories`) возвращаются в DTO, далее преобразуются утилитой `mapCategory` к внутреннему типу (удобно для привязки `category ⇄ subcategory`).
- **Объявления** (`getAnnouncements`, `getAnnouncementById`, создание и редактирование) — обычные REST-вызовы через `fetch`.
- **Авторизация и пользователь** — через контекст `UserContext` (данные профиля, статусы «владелец/гость», избранное и т. п.).
- Все вызовы идут через `/api/...`, а реальный хост подставляется за счёт `rewrites()` в `next.config.ts`.

---
  
## Руководство по развертыванию

### Системные требования
- **Операционная система**: Linux, macOS или Windows с установленным WSL2 (для Windows).
- **Docker**: Docker Desktop (для macOS/Windows) или Docker (для Linux). Рекомендуемая версия: 20.10 или выше.
- **Docker Compose**: Версия 2.x или выше (обычно включена в Docker Desktop).
- **ОЗУ**: Минимум 4 ГБ свободной оперативной памяти для запуска всех контейнеров.

### Шаги по развертыванию

1. **Клонирование репозитория AdBoard**
   Скопируйте репозиторий проекта на локальную машину и перейдите в директорию проекта:
   ```bash
   git clone https://github.com/UsachevDev/adboard-project
   cd AdBoard
   ```
2. **Добавьте в файл .env в корневой директории проекта секреты JWT:**
   ```bash
   JWT_ACCESS_TOKEN_KEY=<сгенерированный ключ>
   ```
3. **Укажите адрес backend для фронтенда**
   В файле `AdBoard.Web/.env.local` задайте переменную окружения:
   ```bash
   NEXT_PUBLIC_API_URL=http://localhost:8080
   ```
   Это URL API, к которому будет обращаться Next.js. При запуске в Docker значение устанавливается через `docker-compose.yml`.
4. **Выполните `docker-compose up --build -d`**
